begin_unit
begin_comment
comment|/*  * Builtin "git log" and related commands (show, whatchanged)  *  * (C) Copyright 2006 Linus Torvalds  *		 2006 Junio Hamano  */
end_comment
begin_include
include|#
directive|include
file|"cache.h"
end_include
begin_include
include|#
directive|include
file|"commit.h"
end_include
begin_include
include|#
directive|include
file|"diff.h"
end_include
begin_include
include|#
directive|include
file|"revision.h"
end_include
begin_include
include|#
directive|include
file|"log-tree.h"
end_include
begin_include
include|#
directive|include
file|"builtin.h"
end_include
begin_function
DECL|function|cmd_log_wc
specifier|static
name|int
name|cmd_log_wc
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|,
name|struct
name|rev_info
modifier|*
name|rev
parameter_list|)
block|{
name|struct
name|commit
modifier|*
name|commit
decl_stmt|;
name|rev
operator|->
name|abbrev
operator|=
name|DEFAULT_ABBREV
expr_stmt|;
name|rev
operator|->
name|commit_format
operator|=
name|CMIT_FMT_DEFAULT
expr_stmt|;
name|rev
operator|->
name|verbose_header
operator|=
literal|1
expr_stmt|;
name|argc
operator|=
name|setup_revisions
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|rev
argument_list|,
literal|"HEAD"
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
name|die
argument_list|(
literal|"unrecognized argument: %s"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|prepare_revision_walk
argument_list|(
name|rev
argument_list|)
expr_stmt|;
name|setup_pager
argument_list|()
expr_stmt|;
while|while
condition|(
operator|(
name|commit
operator|=
name|get_revision
argument_list|(
name|rev
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|log_tree_commit
argument_list|(
name|rev
argument_list|,
name|commit
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|commit
operator|->
name|buffer
argument_list|)
expr_stmt|;
name|commit
operator|->
name|buffer
operator|=
name|NULL
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function
begin_function
DECL|function|cmd_whatchanged
name|int
name|cmd_whatchanged
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
name|struct
name|rev_info
name|rev
decl_stmt|;
name|init_revisions
argument_list|(
operator|&
name|rev
argument_list|)
expr_stmt|;
name|rev
operator|.
name|diff
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|recursive
operator|=
literal|1
expr_stmt|;
return|return
name|cmd_log_wc
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|envp
argument_list|,
operator|&
name|rev
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|cmd_show
name|int
name|cmd_show
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
name|struct
name|rev_info
name|rev
decl_stmt|;
name|init_revisions
argument_list|(
operator|&
name|rev
argument_list|)
expr_stmt|;
name|rev
operator|.
name|diff
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|recursive
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|combine_merges
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|dense_combined_merges
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|always_show_header
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|ignore_merges
operator|=
literal|0
expr_stmt|;
name|rev
operator|.
name|no_walk
operator|=
literal|1
expr_stmt|;
return|return
name|cmd_log_wc
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|envp
argument_list|,
operator|&
name|rev
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|cmd_log
name|int
name|cmd_log
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
name|struct
name|rev_info
name|rev
decl_stmt|;
name|init_revisions
argument_list|(
operator|&
name|rev
argument_list|)
expr_stmt|;
name|rev
operator|.
name|always_show_header
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|recursive
operator|=
literal|1
expr_stmt|;
return|return
name|cmd_log_wc
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|envp
argument_list|,
operator|&
name|rev
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|cmd_format_patch
name|int
name|cmd_format_patch
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
name|struct
name|commit
modifier|*
name|commit
decl_stmt|;
name|struct
name|commit
modifier|*
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
name|struct
name|rev_info
name|rev
decl_stmt|;
name|int
name|nr
init|=
literal|0
decl_stmt|;
name|init_revisions
argument_list|(
operator|&
name|rev
argument_list|)
expr_stmt|;
name|rev
operator|.
name|commit_format
operator|=
name|CMIT_FMT_EMAIL
expr_stmt|;
name|rev
operator|.
name|verbose_header
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diff
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|with_raw
operator|=
literal|0
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|with_stat
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|combine_merges
operator|=
literal|0
expr_stmt|;
name|rev
operator|.
name|ignore_merges
operator|=
literal|1
expr_stmt|;
name|rev
operator|.
name|diffopt
operator|.
name|output_format
operator|=
name|DIFF_FORMAT_PATCH
expr_stmt|;
name|argc
operator|=
name|setup_revisions
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|rev
argument_list|,
literal|"HEAD"
argument_list|)
expr_stmt|;
name|prepare_revision_walk
argument_list|(
operator|&
name|rev
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|commit
operator|=
name|get_revision
argument_list|(
operator|&
name|rev
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|nr
operator|++
expr_stmt|;
name|list
operator|=
name|realloc
argument_list|(
name|list
argument_list|,
name|nr
operator|*
sizeof|sizeof
argument_list|(
name|list
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|list
index|[
name|nr
operator|-
literal|1
index|]
operator|=
name|commit
expr_stmt|;
block|}
while|while
condition|(
literal|0
operator|<=
operator|--
name|nr
condition|)
block|{
name|int
name|shown
decl_stmt|;
name|commit
operator|=
name|list
index|[
name|nr
index|]
expr_stmt|;
name|shown
operator|=
name|log_tree_commit
argument_list|(
operator|&
name|rev
argument_list|,
name|commit
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|commit
operator|->
name|buffer
argument_list|)
expr_stmt|;
name|commit
operator|->
name|buffer
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|shown
condition|)
name|printf
argument_list|(
literal|"-- \n%s\n\n"
argument_list|,
name|git_version_string
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|list
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function
end_unit
