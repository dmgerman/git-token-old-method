begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'## zip archive frontend for git-fast-import'
nl|'\n'
comment|'##'
nl|'\n'
comment|'## For example:'
nl|'\n'
comment|'##'
nl|'\n'
comment|'##  mkdir project; cd project; git init'
nl|'\n'
comment|'##  python import-zips.py *.zip'
nl|'\n'
comment|'##  git log --stat import-zips'
nl|'\n'
nl|'\n'
name|'from'
name|'os'
name|'import'
name|'popen'
op|','
name|'path'
newline|'\n'
name|'from'
name|'sys'
name|'import'
name|'argv'
op|','
name|'exit'
op|','
name|'hexversion'
op|','
name|'stderr'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'mktime'
newline|'\n'
name|'from'
name|'zipfile'
name|'import'
name|'ZipFile'
newline|'\n'
nl|'\n'
name|'if'
name|'hexversion'
op|'<'
number|'0x01060000'
op|':'
newline|'\n'
comment|'# The limiter is the zipfile module'
nl|'\n'
indent|'        '
name|'sys'
op|'.'
name|'stderr'
op|'.'
name|'write'
op|'('
string|'"import-zips.py: requires Python 1.6.0 or later.\\n"'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'argv'
op|')'
op|'<'
number|'2'
op|':'
newline|'\n'
indent|'\t'
name|'print'
string|"'Usage:'"
op|','
name|'argv'
op|'['
number|'0'
op|']'
op|','
string|"'<zipfile>...'"
newline|'\n'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|branch_ref
dedent|''
name|'branch_ref'
op|'='
string|"'refs/heads/import-zips'"
newline|'\n'
DECL|variable|committer_name
name|'committer_name'
op|'='
string|"'Z Ip Creator'"
newline|'\n'
DECL|variable|committer_email
name|'committer_email'
op|'='
string|"'zip@example.com'"
newline|'\n'
nl|'\n'
DECL|variable|fast_import
name|'fast_import'
op|'='
name|'popen'
op|'('
string|"'git fast-import --quiet'"
op|','
string|"'w'"
op|')'
newline|'\n'
DECL|function|printlines
name|'def'
name|'printlines'
op|'('
name|'list'
op|')'
op|':'
newline|'\n'
indent|'\t'
name|'for'
name|'str'
name|'in'
name|'list'
op|':'
newline|'\n'
indent|'\t\t'
name|'fast_import'
op|'.'
name|'write'
op|'('
name|'str'
op|'+'
string|'"\\n"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'zipfile'
name|'in'
name|'argv'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'\t'
name|'commit_time'
op|'='
number|'0'
newline|'\n'
name|'next_mark'
op|'='
number|'1'
newline|'\n'
name|'common_prefix'
op|'='
name|'None'
newline|'\n'
name|'mark'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'zip'
op|'='
name|'ZipFile'
op|'('
name|'zipfile'
op|','
string|"'r'"
op|')'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'zip'
op|'.'
name|'namelist'
op|'('
op|')'
op|':'
newline|'\n'
indent|'\t\t'
name|'if'
name|'name'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'\t\t\t'
name|'continue'
newline|'\n'
dedent|''
name|'info'
op|'='
name|'zip'
op|'.'
name|'getinfo'
op|'('
name|'name'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'commit_time'
op|'<'
name|'info'
op|'.'
name|'date_time'
op|':'
newline|'\n'
indent|'\t\t\t'
name|'commit_time'
op|'='
name|'info'
op|'.'
name|'date_time'
newline|'\n'
dedent|''
name|'if'
name|'common_prefix'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'\t\t\t'
name|'common_prefix'
op|'='
name|'name'
op|'['
op|':'
name|'name'
op|'.'
name|'rfind'
op|'('
string|"'/'"
op|')'
op|'+'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'\t\t\t'
name|'while'
name|'not'
name|'name'
op|'.'
name|'startswith'
op|'('
name|'common_prefix'
op|')'
op|':'
newline|'\n'
indent|'\t\t\t\t'
name|'last_slash'
op|'='
name|'common_prefix'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'.'
name|'rfind'
op|'('
string|"'/'"
op|')'
op|'+'
number|'1'
newline|'\n'
name|'common_prefix'
op|'='
name|'common_prefix'
op|'['
op|':'
name|'last_slash'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'mark'
op|'['
name|'name'
op|']'
op|'='
string|"':'"
op|'+'
name|'str'
op|'('
name|'next_mark'
op|')'
newline|'\n'
name|'next_mark'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
name|'printlines'
op|'('
op|'('
string|"'blob'"
op|','
string|"'mark '"
op|'+'
name|'mark'
op|'['
name|'name'
op|']'
op|','
string|"'data '"
op|'+'
name|'str'
op|'('
name|'info'
op|'.'
name|'file_size'
op|')'
op|')'
op|')'
newline|'\n'
name|'fast_import'
op|'.'
name|'write'
op|'('
name|'zip'
op|'.'
name|'read'
op|'('
name|'name'
op|')'
op|'+'
string|'"\\n"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'committer'
op|'='
name|'committer_name'
op|'+'
string|"' <'"
op|'+'
name|'committer_email'
op|'+'
string|"'> %d +0000'"
op|'%'
name|'mktime'
op|'('
name|'commit_time'
op|'+'
op|'('
number|'0'
op|','
number|'0'
op|','
number|'0'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'printlines'
op|'('
op|'('
string|"'commit '"
op|'+'
name|'branch_ref'
op|','
string|"'committer '"
op|'+'
name|'committer'
op|','
string|"'data <<EOM'"
op|','
string|"'Imported from '"
op|'+'
name|'zipfile'
op|'+'
string|"'.'"
op|','
string|"'EOM'"
op|','
string|"''"
op|','
string|"'deleteall'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'name'
name|'in'
name|'mark'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'\t\t'
name|'fast_import'
op|'.'
name|'write'
op|'('
string|"'M 100644 '"
op|'+'
name|'mark'
op|'['
name|'name'
op|']'
op|'+'
string|"' '"
op|'+'
nl|'\n'
name|'name'
op|'['
name|'len'
op|'('
name|'common_prefix'
op|')'
op|':'
op|']'
op|'+'
string|'"\\n"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'printlines'
op|'('
op|'('
string|"''"
op|','
string|"'tag '"
op|'+'
name|'path'
op|'.'
name|'basename'
op|'('
name|'zipfile'
op|')'
op|','
string|"'from '"
op|'+'
name|'branch_ref'
op|','
string|"'tagger '"
op|'+'
name|'committer'
op|','
string|"'data <<EOM'"
op|','
string|"'Package '"
op|'+'
name|'zipfile'
op|','
string|"'EOM'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'fast_import'
op|'.'
name|'close'
op|'('
op|')'
op|':'
newline|'\n'
indent|'\t'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
