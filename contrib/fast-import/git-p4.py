begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# git-p4.py -- A tool for bidirectional operation between a Perforce depot and git.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Author: Simon Hausmann <hausmann@kde.org>'
nl|'\n'
comment|'# Copyright: 2007 Simon Hausmann <hausmann@kde.org>'
nl|'\n'
comment|'#            2007 Trolltech ASA'
nl|'\n'
comment|'# License: MIT <http://www.opensource.org/licenses/mit-license.php>'
nl|'\n'
comment|'#'
nl|'\n'
nl|'\n'
name|'import'
name|'optparse'
op|','
name|'sys'
op|','
name|'os'
op|','
name|'marshal'
op|','
name|'popen2'
op|','
name|'shelve'
newline|'\n'
name|'import'
name|'tempfile'
op|','
name|'getopt'
op|','
name|'sha'
op|','
name|'os'
op|'.'
name|'path'
op|','
name|'time'
newline|'\n'
name|'from'
name|'sets'
name|'import'
name|'Set'
op|';'
newline|'\n'
nl|'\n'
DECL|variable|gitdir
name|'gitdir'
op|'='
name|'os'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|'"GIT_DIR"'
op|','
string|'""'
op|')'
newline|'\n'
nl|'\n'
DECL|function|p4CmdList
name|'def'
name|'p4CmdList'
op|'('
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'cmd'
op|'='
string|'"p4 -G %s"'
op|'%'
name|'cmd'
newline|'\n'
name|'pipe'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
name|'cmd'
op|','
string|'"rb"'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
op|'['
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'            '
name|'entry'
op|'='
name|'marshal'
op|'.'
name|'load'
op|'('
name|'pipe'
op|')'
newline|'\n'
name|'result'
op|'.'
name|'append'
op|'('
name|'entry'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'except'
name|'EOFError'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
dedent|''
name|'pipe'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'result'
newline|'\n'
nl|'\n'
DECL|function|p4Cmd
dedent|''
name|'def'
name|'p4Cmd'
op|'('
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'list'
op|'='
name|'p4CmdList'
op|'('
name|'cmd'
op|')'
newline|'\n'
name|'result'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'entry'
name|'in'
name|'list'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'.'
name|'update'
op|'('
name|'entry'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'result'
op|';'
newline|'\n'
nl|'\n'
DECL|function|die
dedent|''
name|'def'
name|'die'
op|'('
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sys'
op|'.'
name|'stderr'
op|'.'
name|'write'
op|'('
name|'msg'
op|'+'
string|'"\\n"'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|function|currentGitBranch
dedent|''
name|'def'
name|'currentGitBranch'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-name-rev HEAD"'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|function|isValidGitDir
dedent|''
name|'def'
name|'isValidGitDir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|'+'
string|'"/HEAD"'
op|')'
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|'+'
string|'"/refs"'
op|')'
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|'+'
string|'"/objects"'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'True'
op|';'
newline|'\n'
dedent|''
name|'return'
name|'False'
newline|'\n'
nl|'\n'
DECL|function|system
dedent|''
name|'def'
name|'system'
op|'('
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
name|'cmd'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'        '
name|'die'
op|'('
string|'"command failed: %s"'
op|'%'
name|'cmd'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Command
dedent|''
dedent|''
name|'class'
name|'Command'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'usage'
op|'='
string|'"usage: %prog [options]"'
newline|'\n'
nl|'\n'
DECL|class|P4Debug
dedent|''
dedent|''
name|'class'
name|'P4Debug'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'options'
op|'='
op|'['
nl|'\n'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'description'
op|'='
string|'"A tool to debug the output of p4 -G."'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'output'
name|'in'
name|'p4CmdList'
op|'('
string|'" "'
op|'.'
name|'join'
op|'('
name|'args'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'print'
name|'output'
newline|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|class|P4CleanTags
dedent|''
dedent|''
name|'class'
name|'P4CleanTags'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Command'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'options'
op|'='
op|'['
nl|'\n'
comment|'#                optparse.make_option("--branch", dest="branch", default="refs/heads/master")'
nl|'\n'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'description'
op|'='
string|'"A tool to remove stale unused tags from incremental perforce imports."'
newline|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'branch'
op|'='
name|'currentGitBranch'
op|'('
op|')'
newline|'\n'
name|'print'
string|'"Cleaning out stale p4 import tags..."'
newline|'\n'
name|'sout'
op|','
name|'sin'
op|','
name|'serr'
op|'='
name|'popen2'
op|'.'
name|'popen3'
op|'('
string|'"git-name-rev --tags `git-rev-parse %s`"'
op|'%'
name|'branch'
op|')'
newline|'\n'
name|'output'
op|'='
name|'sout'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'tagIdx'
op|'='
name|'output'
op|'.'
name|'index'
op|'('
string|'" tags/p4/"'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'"Cannot find any p4/* tag. Nothing to do."'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'caretIdx'
op|'='
name|'output'
op|'.'
name|'index'
op|'('
string|'"^"'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'caretIdx'
op|'='
name|'len'
op|'('
name|'output'
op|')'
op|'-'
number|'1'
newline|'\n'
dedent|''
name|'rev'
op|'='
name|'int'
op|'('
name|'output'
op|'['
name|'tagIdx'
op|'+'
number|'9'
op|':'
name|'caretIdx'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'allTags'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git tag -l p4/"'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'allTags'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'allTags'
op|'['
name|'i'
op|']'
op|'='
name|'int'
op|'('
name|'allTags'
op|'['
name|'i'
op|']'
op|'['
number|'3'
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'allTags'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'allTags'
op|'.'
name|'remove'
op|'('
name|'rev'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'rev'
name|'in'
name|'allTags'
op|':'
newline|'\n'
indent|'            '
name|'print'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git tag -d p4/%s"'
op|'%'
name|'rev'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
string|'"%s tags removed."'
op|'%'
name|'len'
op|'('
name|'allTags'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|class|P4Sync
dedent|''
dedent|''
name|'class'
name|'P4Sync'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Command'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'options'
op|'='
op|'['
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--continue"'
op|','
name|'action'
op|'='
string|'"store_false"'
op|','
name|'dest'
op|'='
string|'"firstTime"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--origin"'
op|','
name|'dest'
op|'='
string|'"origin"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--reset"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|','
name|'dest'
op|'='
string|'"reset"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--master"'
op|','
name|'dest'
op|'='
string|'"master"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--log-substitutions"'
op|','
name|'dest'
op|'='
string|'"substFile"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--noninteractive"'
op|','
name|'action'
op|'='
string|'"store_false"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--dry-run"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|')'
nl|'\n'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'description'
op|'='
string|'"Submit changes from git to the perforce depot."'
newline|'\n'
name|'self'
op|'.'
name|'firstTime'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'reset'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'interactive'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'dryRun'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'substFile'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'firstTime'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'origin'
op|'='
string|'"origin"'
newline|'\n'
name|'self'
op|'.'
name|'master'
op|'='
string|'""'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'logSubstitutions'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'logSubstitutions'
op|'['
string|'"<enter description here>"'
op|']'
op|'='
string|'"%log%"'
newline|'\n'
name|'self'
op|'.'
name|'logSubstitutions'
op|'['
string|'"\\tDetails:"'
op|']'
op|'='
string|'"\\tDetails:  %log%"'
newline|'\n'
nl|'\n'
DECL|member|check
dedent|''
name|'def'
name|'check'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'p4CmdList'
op|'('
string|'"opened ..."'
op|')'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'die'
op|'('
string|'"You have files opened with perforce! Close them before starting the sync."'
op|')'
newline|'\n'
nl|'\n'
DECL|member|start
dedent|''
dedent|''
name|'def'
name|'start'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'config'
op|')'
op|'>'
number|'0'
name|'and'
name|'not'
name|'self'
op|'.'
name|'reset'
op|':'
newline|'\n'
indent|'            '
name|'die'
op|'('
string|'"Cannot start sync. Previous sync config found at %s"'
op|'%'
name|'self'
op|'.'
name|'configFile'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'commits'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-rev-list --no-merges %s..%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'origin'
op|','
name|'self'
op|'.'
name|'master'
op|')'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'commits'
op|'.'
name|'append'
op|'('
name|'line'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
name|'commits'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'config'
op|'['
string|'"commits"'
op|']'
op|'='
name|'commits'
newline|'\n'
nl|'\n'
name|'print'
string|'"Creating temporary p4-sync branch from %s ..."'
op|'%'
name|'self'
op|'.'
name|'origin'
newline|'\n'
name|'system'
op|'('
string|'"git checkout -f -b p4-sync %s"'
op|'%'
name|'self'
op|'.'
name|'origin'
op|')'
newline|'\n'
nl|'\n'
DECL|member|prepareLogMessage
dedent|''
name|'def'
name|'prepareLogMessage'
op|'('
name|'self'
op|','
name|'template'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
string|'""'
newline|'\n'
nl|'\n'
name|'for'
name|'line'
name|'in'
name|'template'
op|'.'
name|'split'
op|'('
string|'"\\n"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|'"#"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'+='
name|'line'
op|'+'
string|'"\\n"'
newline|'\n'
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'substituted'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'key'
name|'in'
name|'self'
op|'.'
name|'logSubstitutions'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'line'
op|'.'
name|'find'
op|'('
name|'key'
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'value'
op|'='
name|'self'
op|'.'
name|'logSubstitutions'
op|'['
name|'key'
op|']'
newline|'\n'
name|'value'
op|'='
name|'value'
op|'.'
name|'replace'
op|'('
string|'"%log%"'
op|','
name|'message'
op|')'
newline|'\n'
name|'if'
name|'value'
op|'!='
string|'"@remove@"'
op|':'
newline|'\n'
indent|'                        '
name|'result'
op|'+='
name|'line'
op|'.'
name|'replace'
op|'('
name|'key'
op|','
name|'value'
op|')'
op|'+'
string|'"\\n"'
newline|'\n'
dedent|''
name|'substituted'
op|'='
name|'True'
newline|'\n'
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'substituted'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'+='
name|'line'
op|'+'
string|'"\\n"'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
DECL|member|apply
dedent|''
name|'def'
name|'apply'
op|'('
name|'self'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Applying %s"'
op|'%'
op|'('
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-log --max-count=1 --pretty=oneline %s"'
op|'%'
name|'id'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'diff'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git diff-tree -r --name-status \\"%s^\\" \\"%s\\""'
op|'%'
op|'('
name|'id'
op|','
name|'id'
op|')'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'filesToAdd'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'filesToDelete'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'diff'
op|':'
newline|'\n'
indent|'            '
name|'modifier'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
name|'path'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'modifier'
op|'=='
string|'"M"'
op|':'
newline|'\n'
indent|'                '
name|'system'
op|'('
string|'"p4 edit %s"'
op|'%'
name|'path'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'modifier'
op|'=='
string|'"A"'
op|':'
newline|'\n'
indent|'                '
name|'filesToAdd'
op|'.'
name|'add'
op|'('
name|'path'
op|')'
newline|'\n'
name|'if'
name|'path'
name|'in'
name|'filesToDelete'
op|':'
newline|'\n'
indent|'                    '
name|'filesToDelete'
op|'.'
name|'remove'
op|'('
name|'path'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'modifier'
op|'=='
string|'"D"'
op|':'
newline|'\n'
indent|'                '
name|'filesToDelete'
op|'.'
name|'add'
op|'('
name|'path'
op|')'
newline|'\n'
name|'if'
name|'path'
name|'in'
name|'filesToAdd'
op|':'
newline|'\n'
indent|'                    '
name|'filesToAdd'
op|'.'
name|'remove'
op|'('
name|'path'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'die'
op|'('
string|'"unknown modifier %s for %s"'
op|'%'
op|'('
name|'modifier'
op|','
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'system'
op|'('
string|'"git-diff-files --name-only -z | git-update-index --remove -z --stdin"'
op|')'
newline|'\n'
name|'system'
op|'('
string|'"git cherry-pick --no-commit \\"%s\\""'
op|'%'
name|'id'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'f'
name|'in'
name|'filesToAdd'
op|':'
newline|'\n'
indent|'            '
name|'system'
op|'('
string|'"p4 add %s"'
op|'%'
name|'f'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'f'
name|'in'
name|'filesToDelete'
op|':'
newline|'\n'
indent|'            '
name|'system'
op|'('
string|'"p4 revert %s"'
op|'%'
name|'f'
op|')'
newline|'\n'
name|'system'
op|'('
string|'"p4 delete %s"'
op|'%'
name|'f'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'logMessage'
op|'='
string|'""'
newline|'\n'
name|'foundTitle'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'log'
name|'in'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-cat-file commit %s"'
op|'%'
name|'id'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'foundTitle'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'len'
op|'('
name|'log'
op|')'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'foundTitle'
op|'='
number|'1'
newline|'\n'
dedent|''
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'logMessage'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'logMessage'
op|'+='
string|'"\\t"'
newline|'\n'
dedent|''
name|'logMessage'
op|'+='
name|'log'
newline|'\n'
nl|'\n'
dedent|''
name|'template'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"p4 change -o"'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'interactive'
op|':'
newline|'\n'
indent|'            '
name|'submitTemplate'
op|'='
name|'self'
op|'.'
name|'prepareLogMessage'
op|'('
name|'template'
op|','
name|'logMessage'
op|')'
newline|'\n'
name|'diff'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"p4 diff -du ..."'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'newFile'
name|'in'
name|'filesToAdd'
op|':'
newline|'\n'
indent|'                '
name|'diff'
op|'+='
string|'"==== new file ====\\n"'
newline|'\n'
name|'diff'
op|'+='
string|'"--- /dev/null\\n"'
newline|'\n'
name|'diff'
op|'+='
string|'"+++ %s\\n"'
op|'%'
name|'newFile'
newline|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'newFile'
op|','
string|'"r"'
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'diff'
op|'+='
string|'"+"'
op|'+'
name|'line'
newline|'\n'
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'pipe'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"less"'
op|','
string|'"w"'
op|')'
newline|'\n'
name|'pipe'
op|'.'
name|'write'
op|'('
name|'submitTemplate'
op|'+'
name|'diff'
op|')'
newline|'\n'
name|'pipe'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'response'
op|'='
string|'"e"'
newline|'\n'
name|'while'
name|'response'
op|'=='
string|'"e"'
op|':'
newline|'\n'
indent|'                '
name|'response'
op|'='
name|'raw_input'
op|'('
string|'"Do you want to submit this change (y/e/n)? "'
op|')'
newline|'\n'
name|'if'
name|'response'
op|'=='
string|'"e"'
op|':'
newline|'\n'
indent|'                    '
op|'['
name|'handle'
op|','
name|'fileName'
op|']'
op|'='
name|'tempfile'
op|'.'
name|'mkstemp'
op|'('
op|')'
newline|'\n'
name|'tmpFile'
op|'='
name|'os'
op|'.'
name|'fdopen'
op|'('
name|'handle'
op|','
string|'"w+"'
op|')'
newline|'\n'
name|'tmpFile'
op|'.'
name|'write'
op|'('
name|'submitTemplate'
op|')'
newline|'\n'
name|'tmpFile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'editor'
op|'='
name|'os'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|'"EDITOR"'
op|','
string|'"vi"'
op|')'
newline|'\n'
name|'system'
op|'('
name|'editor'
op|'+'
string|'" "'
op|'+'
name|'fileName'
op|')'
newline|'\n'
name|'tmpFile'
op|'='
name|'open'
op|'('
name|'fileName'
op|','
string|'"r"'
op|')'
newline|'\n'
name|'submitTemplate'
op|'='
name|'tmpFile'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'tmpFile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'remove'
op|'('
name|'fileName'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'response'
op|'=='
string|'"y"'
name|'or'
name|'response'
op|'=='
string|'"yes"'
op|':'
newline|'\n'
indent|'               '
name|'if'
name|'self'
op|'.'
name|'dryRun'
op|':'
newline|'\n'
indent|'                   '
name|'print'
name|'submitTemplate'
newline|'\n'
name|'raw_input'
op|'('
string|'"Press return to continue..."'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'pipe'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"p4 submit -i"'
op|','
string|'"w"'
op|')'
newline|'\n'
name|'pipe'
op|'.'
name|'write'
op|'('
name|'submitTemplate'
op|')'
newline|'\n'
name|'pipe'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"Not submitting!"'
newline|'\n'
name|'self'
op|'.'
name|'interactive'
op|'='
name|'False'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'fileName'
op|'='
string|'"submit.txt"'
newline|'\n'
name|'file'
op|'='
name|'open'
op|'('
name|'fileName'
op|','
string|'"w+"'
op|')'
newline|'\n'
name|'file'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'prepareLogMessage'
op|'('
name|'template'
op|','
name|'logMessage'
op|')'
op|')'
newline|'\n'
name|'file'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'print'
string|'"Perforce submit template written as %s. Please review/edit and then use p4 submit -i < %s to submit directly!"'
op|'%'
op|'('
name|'fileName'
op|','
name|'fileName'
op|')'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'reset'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'firstTime'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'substFile'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'line'
name|'in'
name|'open'
op|'('
name|'self'
op|'.'
name|'substFile'
op|','
string|'"r"'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'tokens'
op|'='
name|'line'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'.'
name|'split'
op|'('
string|'"="'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'logSubstitutions'
op|'['
name|'tokens'
op|'['
number|'0'
op|']'
op|']'
op|'='
name|'tokens'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'master'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'master'
op|'='
name|'currentGitBranch'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'master'
op|')'
op|'=='
number|'0'
name|'or'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
string|'"%s/refs/heads/%s"'
op|'%'
op|'('
name|'gitdir'
op|','
name|'self'
op|'.'
name|'master'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'die'
op|'('
string|'"Detecting current git branch failed!"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'check'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'configFile'
op|'='
name|'gitdir'
op|'+'
string|'"/p4-git-sync.cfg"'
newline|'\n'
name|'self'
op|'.'
name|'config'
op|'='
name|'shelve'
op|'.'
name|'open'
op|'('
name|'self'
op|'.'
name|'configFile'
op|','
name|'writeback'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'firstTime'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'start'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'commits'
op|'='
name|'self'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|'"commits"'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'while'
name|'len'
op|'('
name|'commits'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'firstTime'
op|'='
name|'False'
newline|'\n'
name|'commit'
op|'='
name|'commits'
op|'['
number|'0'
op|']'
newline|'\n'
name|'commits'
op|'='
name|'commits'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'config'
op|'['
string|'"commits"'
op|']'
op|'='
name|'commits'
newline|'\n'
name|'self'
op|'.'
name|'apply'
op|'('
name|'commit'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'interactive'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'config'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'commits'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'firstTime'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"No changes found to apply between %s and current HEAD"'
op|'%'
name|'self'
op|'.'
name|'origin'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"All changes applied!"'
newline|'\n'
name|'print'
string|'"Deleting temporary p4-sync branch and going back to %s"'
op|'%'
name|'self'
op|'.'
name|'master'
newline|'\n'
name|'system'
op|'('
string|'"git checkout %s"'
op|'%'
name|'self'
op|'.'
name|'master'
op|')'
newline|'\n'
name|'system'
op|'('
string|'"git branch -D p4-sync"'
op|')'
newline|'\n'
name|'print'
string|'"Cleaning out your perforce checkout by doing p4 edit ... ; p4 revert ..."'
newline|'\n'
name|'system'
op|'('
string|'"p4 edit ... >/dev/null"'
op|')'
newline|'\n'
name|'system'
op|'('
string|'"p4 revert ... >/dev/null"'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'configFile'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|class|GitSync
dedent|''
dedent|''
name|'class'
name|'GitSync'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Command'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'options'
op|'='
op|'['
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--branch"'
op|','
name|'dest'
op|'='
string|'"branch"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--detect-branches"'
op|','
name|'dest'
op|'='
string|'"detectBranches"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--changesfile"'
op|','
name|'dest'
op|'='
string|'"changesFile"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--silent"'
op|','
name|'dest'
op|'='
string|'"silent"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--known-branches"'
op|','
name|'dest'
op|'='
string|'"knownBranches"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--cache"'
op|','
name|'dest'
op|'='
string|'"doCache"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|')'
op|','
nl|'\n'
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--command-cache"'
op|','
name|'dest'
op|'='
string|'"commandCache"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|')'
nl|'\n'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'description'
op|'='
string|'"""Imports from Perforce into a git repository.\\n\n    example:\n    //depot/my/project/ -- to import the current head\n    //depot/my/project/@all -- to import everything\n    //depot/my/project/@1,6 -- to import only from revision 1 to 6\n\n    (a ... is not needed in the path p4 specification, it\'s added implicitly)"""'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'usage'
op|'+='
string|'" //depot/path[@revRange]"'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'dataCache'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'commandCache'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'silent'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'knownBranches'
op|'='
name|'Set'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'createdBranches'
op|'='
name|'Set'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'committedChanges'
op|'='
name|'Set'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'branch'
op|'='
string|'"master"'
newline|'\n'
name|'self'
op|'.'
name|'detectBranches'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'changesFile'
op|'='
string|'""'
newline|'\n'
nl|'\n'
DECL|member|p4File
dedent|''
name|'def'
name|'p4File'
op|'('
name|'self'
op|','
name|'depotPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"p4 print -q \\"%s\\""'
op|'%'
name|'depotPath'
op|','
string|'"rb"'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|extractFilesFromCommit
dedent|''
name|'def'
name|'extractFilesFromCommit'
op|'('
name|'self'
op|','
name|'commit'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'files'
op|'='
op|'['
op|']'
newline|'\n'
name|'fnum'
op|'='
number|'0'
newline|'\n'
name|'while'
name|'commit'
op|'.'
name|'has_key'
op|'('
string|'"depotFile%s"'
op|'%'
name|'fnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'commit'
op|'['
string|'"depotFile%s"'
op|'%'
name|'fnum'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'path'
op|'.'
name|'startswith'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|':'
newline|'\n'
comment|'#            if not self.silent:'
nl|'\n'
comment|'#                print "\\nchanged files: ignoring path %s outside of %s in change %s" % (path, self.globalPrefix, change)'
nl|'\n'
indent|'                '
name|'fnum'
op|'='
name|'fnum'
op|'+'
number|'1'
newline|'\n'
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'file'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'file'
op|'['
string|'"path"'
op|']'
op|'='
name|'path'
newline|'\n'
name|'file'
op|'['
string|'"rev"'
op|']'
op|'='
name|'commit'
op|'['
string|'"rev%s"'
op|'%'
name|'fnum'
op|']'
newline|'\n'
name|'file'
op|'['
string|'"action"'
op|']'
op|'='
name|'commit'
op|'['
string|'"action%s"'
op|'%'
name|'fnum'
op|']'
newline|'\n'
name|'file'
op|'['
string|'"type"'
op|']'
op|'='
name|'commit'
op|'['
string|'"type%s"'
op|'%'
name|'fnum'
op|']'
newline|'\n'
name|'files'
op|'.'
name|'append'
op|'('
name|'file'
op|')'
newline|'\n'
name|'fnum'
op|'='
name|'fnum'
op|'+'
number|'1'
newline|'\n'
dedent|''
name|'return'
name|'files'
newline|'\n'
nl|'\n'
DECL|member|isSubPathOf
dedent|''
name|'def'
name|'isSubPathOf'
op|'('
name|'self'
op|','
name|'first'
op|','
name|'second'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'first'
op|'.'
name|'startswith'
op|'('
name|'second'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'if'
name|'first'
op|'=='
name|'second'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'return'
name|'first'
op|'['
name|'len'
op|'('
name|'second'
op|')'
op|']'
op|'=='
string|'"/"'
newline|'\n'
nl|'\n'
DECL|member|branchesForCommit
dedent|''
name|'def'
name|'branchesForCommit'
op|'('
name|'self'
op|','
name|'files'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'branches'
op|'='
name|'Set'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'file'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'relativePath'
op|'='
name|'file'
op|'['
string|'"path"'
op|']'
op|'['
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|':'
op|']'
newline|'\n'
comment|'# strip off the filename'
nl|'\n'
name|'relativePath'
op|'='
name|'relativePath'
op|'['
number|'0'
op|':'
name|'relativePath'
op|'.'
name|'rfind'
op|'('
string|'"/"'
op|')'
op|']'
newline|'\n'
nl|'\n'
comment|'#        if len(branches) == 0:'
nl|'\n'
comment|'#            branches.add(relativePath)'
nl|'\n'
comment|'#            knownBranches.add(relativePath)'
nl|'\n'
comment|'#            continue'
nl|'\n'
nl|'\n'
comment|'###### this needs more testing :)'
nl|'\n'
name|'knownBranch'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'branch'
name|'in'
name|'branches'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'relativePath'
op|'=='
name|'branch'
op|':'
newline|'\n'
indent|'                    '
name|'knownBranch'
op|'='
name|'True'
newline|'\n'
name|'break'
newline|'\n'
comment|'#            if relativePath.startswith(branch):'
nl|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'isSubPathOf'
op|'('
name|'relativePath'
op|','
name|'branch'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'knownBranch'
op|'='
name|'True'
newline|'\n'
name|'break'
newline|'\n'
comment|'#            if branch.startswith(relativePath):'
nl|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'isSubPathOf'
op|'('
name|'branch'
op|','
name|'relativePath'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'branches'
op|'.'
name|'remove'
op|'('
name|'branch'
op|')'
newline|'\n'
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'knownBranch'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'branch'
name|'in'
name|'knownBranches'
op|':'
newline|'\n'
comment|'#if relativePath.startswith(branch):'
nl|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'isSubPathOf'
op|'('
name|'relativePath'
op|','
name|'branch'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'len'
op|'('
name|'branches'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                        '
name|'relativePath'
op|'='
name|'branch'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'knownBranch'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'knownBranch'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'branches'
op|'.'
name|'add'
op|'('
name|'relativePath'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'knownBranches'
op|'.'
name|'add'
op|'('
name|'relativePath'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'branches'
newline|'\n'
nl|'\n'
DECL|member|findBranchParent
dedent|''
name|'def'
name|'findBranchParent'
op|'('
name|'self'
op|','
name|'branchPrefix'
op|','
name|'files'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'file'
op|'['
string|'"path"'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'path'
op|'.'
name|'startswith'
op|'('
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'action'
op|'='
name|'file'
op|'['
string|'"action"'
op|']'
newline|'\n'
name|'if'
name|'action'
op|'!='
string|'"integrate"'
name|'and'
name|'action'
op|'!='
string|'"branch"'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'rev'
op|'='
name|'file'
op|'['
string|'"rev"'
op|']'
newline|'\n'
name|'depotPath'
op|'='
name|'path'
op|'+'
string|'"#"'
op|'+'
name|'rev'
newline|'\n'
nl|'\n'
name|'log'
op|'='
name|'p4CmdList'
op|'('
string|'"filelog \\"%s\\""'
op|'%'
name|'depotPath'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'log'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! I got confused by the filelog of %s"'
op|'%'
name|'depotPath'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
nl|'\n'
dedent|''
name|'log'
op|'='
name|'log'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'log'
op|'['
string|'"action0"'
op|']'
op|'!='
name|'action'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! wrong action in filelog for %s : found %s, expected %s"'
op|'%'
op|'('
name|'depotPath'
op|','
name|'log'
op|'['
string|'"action0"'
op|']'
op|','
name|'action'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
nl|'\n'
dedent|''
name|'branchAction'
op|'='
name|'log'
op|'['
string|'"how0,0"'
op|']'
newline|'\n'
comment|'#        if branchAction == "branch into" or branchAction == "ignored":'
nl|'\n'
comment|'#            continue # ignore for branching'
nl|'\n'
nl|'\n'
name|'if'
name|'not'
name|'branchAction'
op|'.'
name|'endswith'
op|'('
string|'" from"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
comment|'# ignore for branching'
newline|'\n'
comment|'#            print "eek! file %s was not branched from but instead: %s" % (depotPath, branchAction)'
nl|'\n'
comment|'#            sys.exit(1);'
nl|'\n'
nl|'\n'
dedent|''
name|'source'
op|'='
name|'log'
op|'['
string|'"file0,0"'
op|']'
newline|'\n'
name|'if'
name|'source'
op|'.'
name|'startswith'
op|'('
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'lastSourceRev'
op|'='
name|'log'
op|'['
string|'"erev0,0"'
op|']'
newline|'\n'
nl|'\n'
name|'sourceLog'
op|'='
name|'p4CmdList'
op|'('
string|'"filelog -m 1 \\"%s%s\\""'
op|'%'
op|'('
name|'source'
op|','
name|'lastSourceRev'
op|')'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'sourceLog'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! I got confused by the source filelog of %s%s"'
op|'%'
op|'('
name|'source'
op|','
name|'lastSourceRev'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
dedent|''
name|'sourceLog'
op|'='
name|'sourceLog'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'relPath'
op|'='
name|'source'
op|'['
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|':'
op|']'
newline|'\n'
comment|'# strip off the filename'
nl|'\n'
name|'relPath'
op|'='
name|'relPath'
op|'['
number|'0'
op|':'
name|'relPath'
op|'.'
name|'rfind'
op|'('
string|'"/"'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'branch'
name|'in'
name|'self'
op|'.'
name|'knownBranches'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'isSubPathOf'
op|'('
name|'relPath'
op|','
name|'branch'
op|')'
op|':'
newline|'\n'
comment|'#                print "determined parent branch branch %s due to change in file %s" % (branch, source)'
nl|'\n'
indent|'                    '
name|'return'
name|'branch'
newline|'\n'
comment|'#            else:'
nl|'\n'
comment|'#                print "%s is not a subpath of branch %s" % (relPath, branch)'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
string|'""'
newline|'\n'
nl|'\n'
DECL|member|commit
dedent|''
name|'def'
name|'commit'
op|'('
name|'self'
op|','
name|'details'
op|','
name|'files'
op|','
name|'branch'
op|','
name|'branchPrefix'
op|','
name|'parent'
op|','
name|'merged'
op|'='
string|'""'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'epoch'
op|'='
name|'details'
op|'['
string|'"time"'
op|']'
newline|'\n'
name|'author'
op|'='
name|'details'
op|'['
string|'"user"'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"commit %s\\n"'
op|'%'
name|'branch'
op|')'
newline|'\n'
comment|'#    gitStream.write("mark :%s\\n" % details["change"])'
nl|'\n'
name|'self'
op|'.'
name|'committedChanges'
op|'.'
name|'add'
op|'('
name|'int'
op|'('
name|'details'
op|'['
string|'"change"'
op|']'
op|')'
op|')'
newline|'\n'
name|'committer'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'author'
name|'in'
name|'self'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'committer'
op|'='
string|'"%s %s %s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'users'
op|'['
name|'author'
op|']'
op|','
name|'epoch'
op|','
name|'self'
op|'.'
name|'tz'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'committer'
op|'='
string|'"%s <a@b> %s %s"'
op|'%'
op|'('
name|'author'
op|','
name|'epoch'
op|','
name|'self'
op|'.'
name|'tz'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"committer %s\\n"'
op|'%'
name|'committer'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"data <<EOT\\n"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
name|'details'
op|'['
string|'"desc"'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"\\n[ imported from %s; change %s ]\\n"'
op|'%'
op|'('
name|'branchPrefix'
op|','
name|'details'
op|'['
string|'"change"'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"EOT\\n\\n"'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'parent'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"from %s\\n"'
op|'%'
name|'parent'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'merged'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"merge %s\\n"'
op|'%'
name|'merged'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'file'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'file'
op|'['
string|'"path"'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'path'
op|'.'
name|'startswith'
op|'('
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
comment|'#            if not silent:'
nl|'\n'
comment|'#                print "\\nchanged files: ignoring path %s outside of branch prefix %s in change %s" % (path, branchPrefix, details["change"])'
nl|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'rev'
op|'='
name|'file'
op|'['
string|'"rev"'
op|']'
newline|'\n'
name|'depotPath'
op|'='
name|'path'
op|'+'
string|'"#"'
op|'+'
name|'rev'
newline|'\n'
name|'relPath'
op|'='
name|'path'
op|'['
name|'len'
op|'('
name|'branchPrefix'
op|')'
op|':'
op|']'
newline|'\n'
name|'action'
op|'='
name|'file'
op|'['
string|'"action"'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'file'
op|'['
string|'"type"'
op|']'
op|'=='
string|'"apple"'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"\\nfile %s is a strange apple file that forks. Ignoring!"'
op|'%'
name|'path'
newline|'\n'
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'action'
op|'=='
string|'"delete"'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"D %s\\n"'
op|'%'
name|'relPath'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'mode'
op|'='
number|'644'
newline|'\n'
name|'if'
name|'file'
op|'['
string|'"type"'
op|']'
op|'.'
name|'startswith'
op|'('
string|'"x"'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'mode'
op|'='
number|'755'
newline|'\n'
nl|'\n'
dedent|''
name|'data'
op|'='
name|'self'
op|'.'
name|'p4File'
op|'('
name|'depotPath'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"M %s inline %s\\n"'
op|'%'
op|'('
name|'mode'
op|','
name|'relPath'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"data %s\\n"'
op|'%'
name|'len'
op|'('
name|'data'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"\\n"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"\\n"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'lastChange'
op|'='
name|'int'
op|'('
name|'details'
op|'['
string|'"change"'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|extractFilesInCommitToBranch
dedent|''
name|'def'
name|'extractFilesInCommitToBranch'
op|'('
name|'self'
op|','
name|'files'
op|','
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'newFiles'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'file'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'file'
op|'['
string|'"path"'
op|']'
newline|'\n'
name|'if'
name|'path'
op|'.'
name|'startswith'
op|'('
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'newFiles'
op|'.'
name|'append'
op|'('
name|'file'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'newFiles'
newline|'\n'
nl|'\n'
DECL|member|findBranchSourceHeuristic
dedent|''
name|'def'
name|'findBranchSourceHeuristic'
op|'('
name|'self'
op|','
name|'files'
op|','
name|'branch'
op|','
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'action'
op|'='
name|'file'
op|'['
string|'"action"'
op|']'
newline|'\n'
name|'if'
name|'action'
op|'!='
string|'"integrate"'
name|'and'
name|'action'
op|'!='
string|'"branch"'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'path'
op|'='
name|'file'
op|'['
string|'"path"'
op|']'
newline|'\n'
name|'rev'
op|'='
name|'file'
op|'['
string|'"rev"'
op|']'
newline|'\n'
name|'depotPath'
op|'='
name|'path'
op|'+'
string|'"#"'
op|'+'
name|'rev'
newline|'\n'
nl|'\n'
name|'log'
op|'='
name|'p4CmdList'
op|'('
string|'"filelog \\"%s\\""'
op|'%'
name|'depotPath'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'log'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! I got confused by the filelog of %s"'
op|'%'
name|'depotPath'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
nl|'\n'
dedent|''
name|'log'
op|'='
name|'log'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'log'
op|'['
string|'"action0"'
op|']'
op|'!='
name|'action'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! wrong action in filelog for %s : found %s, expected %s"'
op|'%'
op|'('
name|'depotPath'
op|','
name|'log'
op|'['
string|'"action0"'
op|']'
op|','
name|'action'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
nl|'\n'
dedent|''
name|'branchAction'
op|'='
name|'log'
op|'['
string|'"how0,0"'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'branchAction'
op|'.'
name|'endswith'
op|'('
string|'" from"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
comment|'# ignore for branching'
newline|'\n'
comment|'#            print "eek! file %s was not branched from but instead: %s" % (depotPath, branchAction)'
nl|'\n'
comment|'#            sys.exit(1);'
nl|'\n'
nl|'\n'
dedent|''
name|'source'
op|'='
name|'log'
op|'['
string|'"file0,0"'
op|']'
newline|'\n'
name|'if'
name|'source'
op|'.'
name|'startswith'
op|'('
name|'branchPrefix'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'lastSourceRev'
op|'='
name|'log'
op|'['
string|'"erev0,0"'
op|']'
newline|'\n'
nl|'\n'
name|'sourceLog'
op|'='
name|'p4CmdList'
op|'('
string|'"filelog -m 1 \\"%s%s\\""'
op|'%'
op|'('
name|'source'
op|','
name|'lastSourceRev'
op|')'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'sourceLog'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"eek! I got confused by the source filelog of %s%s"'
op|'%'
op|'('
name|'source'
op|','
name|'lastSourceRev'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
op|';'
newline|'\n'
dedent|''
name|'sourceLog'
op|'='
name|'sourceLog'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'relPath'
op|'='
name|'source'
op|'['
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|':'
op|']'
newline|'\n'
comment|'# strip off the filename'
nl|'\n'
name|'relPath'
op|'='
name|'relPath'
op|'['
number|'0'
op|':'
name|'relPath'
op|'.'
name|'rfind'
op|'('
string|'"/"'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'candidate'
name|'in'
name|'self'
op|'.'
name|'knownBranches'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'isSubPathOf'
op|'('
name|'relPath'
op|','
name|'candidate'
op|')'
name|'and'
name|'candidate'
op|'!='
name|'branch'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'candidate'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
string|'""'
newline|'\n'
nl|'\n'
DECL|member|changeIsBranchMerge
dedent|''
name|'def'
name|'changeIsBranchMerge'
op|'('
name|'self'
op|','
name|'sourceBranch'
op|','
name|'destinationBranch'
op|','
name|'change'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sourceFiles'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'file'
name|'in'
name|'p4CmdList'
op|'('
string|'"files %s...@%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|'+'
name|'sourceBranch'
op|'+'
string|'"/"'
op|','
name|'change'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'file'
op|'['
string|'"action"'
op|']'
op|'=='
string|'"delete"'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'sourceFiles'
op|'['
name|'file'
op|'['
string|'"depotFile"'
op|']'
op|']'
op|'='
name|'file'
newline|'\n'
nl|'\n'
dedent|''
name|'destinationFiles'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'file'
name|'in'
name|'p4CmdList'
op|'('
string|'"files %s...@%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|'+'
name|'destinationBranch'
op|'+'
string|'"/"'
op|','
name|'change'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'destinationFiles'
op|'['
name|'file'
op|'['
string|'"depotFile"'
op|']'
op|']'
op|'='
name|'file'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'fileName'
name|'in'
name|'sourceFiles'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'integrations'
op|'='
op|'['
op|']'
newline|'\n'
name|'deleted'
op|'='
name|'False'
newline|'\n'
name|'integrationCount'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'integration'
name|'in'
name|'p4CmdList'
op|'('
string|'"integrated \\"%s\\""'
op|'%'
name|'fileName'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'toFile'
op|'='
name|'integration'
op|'['
string|'"fromFile"'
op|']'
comment|"# yes, it's true, it's fromFile"
newline|'\n'
name|'if'
name|'not'
name|'toFile'
name|'in'
name|'destinationFiles'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
dedent|''
name|'destFile'
op|'='
name|'destinationFiles'
op|'['
name|'toFile'
op|']'
newline|'\n'
name|'if'
name|'destFile'
op|'['
string|'"action"'
op|']'
op|'=='
string|'"delete"'
op|':'
newline|'\n'
comment|'#                print "file %s has been deleted in %s" % (fileName, toFile)'
nl|'\n'
indent|'                    '
name|'deleted'
op|'='
name|'True'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
name|'integrationCount'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'integration'
op|'['
string|'"how"'
op|']'
op|'=='
string|'"branch from"'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'int'
op|'('
name|'integration'
op|'['
string|'"change"'
op|']'
op|')'
op|'=='
name|'change'
op|':'
newline|'\n'
indent|'                    '
name|'integrations'
op|'.'
name|'append'
op|'('
name|'integration'
op|')'
newline|'\n'
name|'continue'
newline|'\n'
dedent|''
name|'if'
name|'int'
op|'('
name|'integration'
op|'['
string|'"change"'
op|']'
op|')'
op|'>'
name|'change'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'destRev'
op|'='
name|'int'
op|'('
name|'destFile'
op|'['
string|'"rev"'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'startRev'
op|'='
name|'integration'
op|'['
string|'"startFromRev"'
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'if'
name|'startRev'
op|'=='
string|'"none"'
op|':'
newline|'\n'
indent|'                    '
name|'startRev'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'startRev'
op|'='
name|'int'
op|'('
name|'startRev'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'endRev'
op|'='
name|'integration'
op|'['
string|'"endFromRev"'
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'if'
name|'endRev'
op|'=='
string|'"none"'
op|':'
newline|'\n'
indent|'                    '
name|'endRev'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'endRev'
op|'='
name|'int'
op|'('
name|'endRev'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'initialBranch'
op|'='
op|'('
name|'destRev'
op|'=='
number|'1'
name|'and'
name|'integration'
op|'['
string|'"how"'
op|']'
op|'!='
string|'"branch into"'
op|')'
newline|'\n'
name|'inRange'
op|'='
op|'('
name|'destRev'
op|'>='
name|'startRev'
name|'and'
name|'destRev'
op|'<='
name|'endRev'
op|')'
newline|'\n'
name|'newer'
op|'='
op|'('
name|'destRev'
op|'>'
name|'startRev'
name|'and'
name|'destRev'
op|'>'
name|'endRev'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'initialBranch'
name|'or'
name|'inRange'
name|'or'
name|'newer'
op|':'
newline|'\n'
indent|'                    '
name|'integrations'
op|'.'
name|'append'
op|'('
name|'integration'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'deleted'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'integrations'
op|')'
op|'=='
number|'0'
name|'and'
name|'integrationCount'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"file %s was not integrated from %s into %s"'
op|'%'
op|'('
name|'fileName'
op|','
name|'sourceBranch'
op|','
name|'destinationBranch'
op|')'
newline|'\n'
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|getUserMap
dedent|''
name|'def'
name|'getUserMap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'users'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'output'
name|'in'
name|'p4CmdList'
op|'('
string|'"users"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'output'
op|'.'
name|'has_key'
op|'('
string|'"User"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'users'
op|'['
name|'output'
op|'['
string|'"User"'
op|']'
op|']'
op|'='
name|'output'
op|'['
string|'"FullName"'
op|']'
op|'+'
string|'" <"'
op|'+'
name|'output'
op|'['
string|'"Email"'
op|']'
op|'+'
string|'">"'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'branch'
op|'='
string|'"refs/heads/"'
op|'+'
name|'self'
op|'.'
name|'branch'
newline|'\n'
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'self'
op|'.'
name|'previousDepotPath'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-repo-config --get p4.depotpath"'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'args'
op|')'
op|'=='
number|'0'
name|'and'
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'self'
op|'.'
name|'silent'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"[using previously specified depot path %s]"'
op|'%'
name|'self'
op|'.'
name|'globalPrefix'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'len'
op|'('
name|'args'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|'!='
number|'0'
name|'and'
name|'self'
op|'.'
name|'globalPrefix'
op|'!='
name|'args'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'print'
string|'"previous import used depot path %s and now %s was specified. this doesn\'t work!"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'args'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'args'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'changeRange'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'revision'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'users'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'initialParent'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'lastChange'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'initialTag'
op|'='
string|'""'
newline|'\n'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'find'
op|'('
string|'"@"'
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'atIdx'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'index'
op|'('
string|'"@"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'changeRange'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
name|'atIdx'
op|':'
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'changeRange'
op|'=='
string|'"@all"'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'changeRange'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'changeRange'
op|'.'
name|'find'
op|'('
string|'","'
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'revision'
op|'='
name|'self'
op|'.'
name|'changeRange'
newline|'\n'
name|'self'
op|'.'
name|'changeRange'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
number|'0'
op|':'
name|'atIdx'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'find'
op|'('
string|'"#"'
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'hashIdx'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'index'
op|'('
string|'"#"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'revision'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
name|'hashIdx'
op|':'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
number|'0'
op|':'
name|'hashIdx'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'len'
op|'('
name|'self'
op|'.'
name|'previousDepotPath'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'revision'
op|'='
string|'"#head"'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'endswith'
op|'('
string|'"..."'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'globalPrefix'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'['
op|':'
op|'-'
number|'3'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'globalPrefix'
op|'.'
name|'endswith'
op|'('
string|'"/"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'globalPrefix'
op|'+='
string|'"/"'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'getUserMap'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'changeRange'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'sout'
op|','
name|'sin'
op|','
name|'serr'
op|'='
name|'popen2'
op|'.'
name|'popen3'
op|'('
string|'"git-name-rev --tags `git-rev-parse %s`"'
op|'%'
name|'self'
op|'.'
name|'branch'
op|')'
newline|'\n'
name|'output'
op|'='
name|'sout'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'output'
op|'.'
name|'endswith'
op|'('
string|'"\\n"'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'output'
op|'='
name|'output'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'tagIdx'
op|'='
name|'output'
op|'.'
name|'index'
op|'('
string|'" tags/p4/"'
op|')'
newline|'\n'
name|'caretIdx'
op|'='
name|'output'
op|'.'
name|'find'
op|'('
string|'"^"'
op|')'
newline|'\n'
name|'endPos'
op|'='
name|'len'
op|'('
name|'output'
op|')'
newline|'\n'
name|'if'
name|'caretIdx'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'endPos'
op|'='
name|'caretIdx'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'rev'
op|'='
name|'int'
op|'('
name|'output'
op|'['
name|'tagIdx'
op|'+'
number|'9'
op|':'
name|'endPos'
op|']'
op|')'
op|'+'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'changeRange'
op|'='
string|'"@%s,#head"'
op|'%'
name|'self'
op|'.'
name|'rev'
newline|'\n'
name|'self'
op|'.'
name|'initialParent'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-rev-parse %s"'
op|'%'
name|'self'
op|'.'
name|'branch'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'initialTag'
op|'='
string|'"p4/%s"'
op|'%'
op|'('
name|'int'
op|'('
name|'self'
op|'.'
name|'rev'
op|')'
op|'-'
number|'1'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'tz'
op|'='
op|'-'
name|'time'
op|'.'
name|'timezone'
op|'/'
number|'36'
newline|'\n'
name|'tzsign'
op|'='
op|'('
string|'"%s"'
op|'%'
name|'self'
op|'.'
name|'tz'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'tzsign'
op|'!='
string|"'+'"
name|'and'
name|'tzsign'
op|'!='
string|"'-'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'tz'
op|'='
string|'"+"'
op|'+'
op|'('
string|'"%s"'
op|'%'
name|'self'
op|'.'
name|'tz'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'gitOutput'
op|','
name|'self'
op|'.'
name|'gitStream'
op|','
name|'self'
op|'.'
name|'gitError'
op|'='
name|'popen2'
op|'.'
name|'popen3'
op|'('
string|'"git-fast-import"'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'revision'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'"Doing initial import of %s from revision %s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'self'
op|'.'
name|'revision'
op|')'
newline|'\n'
nl|'\n'
name|'details'
op|'='
op|'{'
string|'"user"'
op|':'
string|'"git perforce import user"'
op|','
string|'"time"'
op|':'
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'}'
newline|'\n'
name|'details'
op|'['
string|'"desc"'
op|']'
op|'='
string|'"Initial import of %s from the state at revision %s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'self'
op|'.'
name|'revision'
op|')'
newline|'\n'
name|'details'
op|'['
string|'"change"'
op|']'
op|'='
name|'self'
op|'.'
name|'revision'
newline|'\n'
name|'newestRevision'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'fileCnt'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'info'
name|'in'
name|'p4CmdList'
op|'('
string|'"files %s...%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'self'
op|'.'
name|'revision'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'change'
op|'='
name|'int'
op|'('
name|'info'
op|'['
string|'"change"'
op|']'
op|')'
newline|'\n'
name|'if'
name|'change'
op|'>'
name|'newestRevision'
op|':'
newline|'\n'
indent|'                    '
name|'newestRevision'
op|'='
name|'change'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'info'
op|'['
string|'"action"'
op|']'
op|'=='
string|'"delete"'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'prop'
name|'in'
op|'['
string|'"depotFile"'
op|','
string|'"rev"'
op|','
string|'"action"'
op|','
string|'"type"'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'details'
op|'['
string|'"%s%s"'
op|'%'
op|'('
name|'prop'
op|','
name|'fileCnt'
op|')'
op|']'
op|'='
name|'info'
op|'['
name|'prop'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'fileCnt'
op|'='
name|'fileCnt'
op|'+'
number|'1'
newline|'\n'
nl|'\n'
dedent|''
name|'details'
op|'['
string|'"change"'
op|']'
op|'='
name|'newestRevision'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'commit'
op|'('
name|'details'
op|','
name|'self'
op|'.'
name|'extractFilesFromCommit'
op|'('
name|'details'
op|')'
op|','
name|'self'
op|'.'
name|'branch'
op|','
name|'self'
op|'.'
name|'globalPrefix'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'print'
name|'self'
op|'.'
name|'gitError'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'changes'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'changesFile'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'output'
op|'='
name|'open'
op|'('
name|'self'
op|'.'
name|'changesFile'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'changeSet'
op|'='
name|'Set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'output'
op|':'
newline|'\n'
indent|'                    '
name|'changeSet'
op|'.'
name|'add'
op|'('
name|'int'
op|'('
name|'line'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'change'
name|'in'
name|'changeSet'
op|':'
newline|'\n'
indent|'                    '
name|'changes'
op|'.'
name|'append'
op|'('
name|'change'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'changes'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'output'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|'"p4 changes %s...%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'self'
op|'.'
name|'changeRange'
op|')'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'line'
name|'in'
name|'output'
op|':'
newline|'\n'
indent|'                    '
name|'changeNum'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'changes'
op|'.'
name|'append'
op|'('
name|'changeNum'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'changes'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'changes'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'self'
op|'.'
name|'silent'
op|':'
newline|'\n'
indent|'                    '
name|'print'
string|'"no changes to import!"'
newline|'\n'
dedent|''
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cnt'
op|'='
number|'1'
newline|'\n'
name|'for'
name|'change'
name|'in'
name|'changes'
op|':'
newline|'\n'
indent|'                '
name|'description'
op|'='
name|'p4Cmd'
op|'('
string|'"describe %s"'
op|'%'
name|'change'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'silent'
op|':'
newline|'\n'
indent|'                    '
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
string|'"\\rimporting revision %s (%s%%)"'
op|'%'
op|'('
name|'change'
op|','
name|'cnt'
op|'*'
number|'100'
op|'/'
name|'len'
op|'('
name|'changes'
op|')'
op|')'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
dedent|''
name|'cnt'
op|'='
name|'cnt'
op|'+'
number|'1'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'files'
op|'='
name|'self'
op|'.'
name|'extractFilesFromCommit'
op|'('
name|'description'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'detectBranches'
op|':'
newline|'\n'
indent|'                        '
name|'for'
name|'branch'
name|'in'
name|'self'
op|'.'
name|'branchesForCommit'
op|'('
name|'files'
op|')'
op|':'
newline|'\n'
indent|'                            '
name|'self'
op|'.'
name|'knownBranches'
op|'.'
name|'add'
op|'('
name|'branch'
op|')'
newline|'\n'
name|'branchPrefix'
op|'='
name|'self'
op|'.'
name|'globalPrefix'
op|'+'
name|'branch'
op|'+'
string|'"/"'
newline|'\n'
nl|'\n'
name|'filesForCommit'
op|'='
name|'self'
op|'.'
name|'extractFilesInCommitToBranch'
op|'('
name|'files'
op|','
name|'branchPrefix'
op|')'
newline|'\n'
nl|'\n'
name|'merged'
op|'='
string|'""'
newline|'\n'
name|'parent'
op|'='
string|'""'
newline|'\n'
comment|'########### remove cnt!!!'
nl|'\n'
name|'if'
name|'branch'
name|'not'
name|'in'
name|'self'
op|'.'
name|'createdBranches'
name|'and'
name|'cnt'
op|'>'
number|'2'
op|':'
newline|'\n'
indent|'                                '
name|'self'
op|'.'
name|'createdBranches'
op|'.'
name|'add'
op|'('
name|'branch'
op|')'
newline|'\n'
name|'parent'
op|'='
name|'self'
op|'.'
name|'findBranchParent'
op|'('
name|'branchPrefix'
op|','
name|'files'
op|')'
newline|'\n'
name|'if'
name|'parent'
op|'=='
name|'branch'
op|':'
newline|'\n'
indent|'                                    '
name|'parent'
op|'='
string|'""'
newline|'\n'
comment|'#                    elif len(parent) > 0:'
nl|'\n'
comment|'#                        print "%s branched off of %s" % (branch, parent)'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'len'
op|'('
name|'parent'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                                '
name|'merged'
op|'='
name|'self'
op|'.'
name|'findBranchSourceHeuristic'
op|'('
name|'filesForCommit'
op|','
name|'branch'
op|','
name|'branchPrefix'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'merged'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                                    '
name|'print'
string|'"change %s could be a merge from %s into %s"'
op|'%'
op|'('
name|'description'
op|'['
string|'"change"'
op|']'
op|','
name|'merged'
op|','
name|'branch'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'changeIsBranchMerge'
op|'('
name|'merged'
op|','
name|'branch'
op|','
name|'int'
op|'('
name|'description'
op|'['
string|'"change"'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                                        '
name|'merged'
op|'='
string|'""'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'branch'
op|'='
string|'"refs/heads/"'
op|'+'
name|'branch'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'parent'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                                '
name|'parent'
op|'='
string|'"refs/heads/"'
op|'+'
name|'parent'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'merged'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                                '
name|'merged'
op|'='
string|'"refs/heads/"'
op|'+'
name|'merged'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'commit'
op|'('
name|'description'
op|','
name|'files'
op|','
name|'branch'
op|','
name|'branchPrefix'
op|','
name|'parent'
op|','
name|'merged'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'self'
op|'.'
name|'commit'
op|'('
name|'description'
op|','
name|'files'
op|','
name|'self'
op|'.'
name|'branch'
op|','
name|'self'
op|'.'
name|'globalPrefix'
op|','
name|'self'
op|'.'
name|'initialParent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'initialParent'
op|'='
string|'""'
newline|'\n'
dedent|''
dedent|''
name|'except'
name|'IOError'
op|':'
newline|'\n'
indent|'                    '
name|'print'
name|'self'
op|'.'
name|'gitError'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'silent'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'""'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"reset refs/tags/p4/%s\\n"'
op|'%'
name|'self'
op|'.'
name|'lastChange'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'write'
op|'('
string|'"from %s\\n\\n"'
op|'%'
name|'self'
op|'.'
name|'branch'
op|')'
op|';'
newline|'\n'
nl|'\n'
nl|'\n'
name|'self'
op|'.'
name|'gitStream'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitOutput'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'gitError'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git-repo-config p4.depotpath %s"'
op|'%'
name|'self'
op|'.'
name|'globalPrefix'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'initialTag'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'popen'
op|'('
string|'"git tag -d %s"'
op|'%'
name|'self'
op|'.'
name|'initialTag'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|class|HelpFormatter
dedent|''
dedent|''
name|'class'
name|'HelpFormatter'
op|'('
name|'optparse'
op|'.'
name|'IndentedHelpFormatter'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'optparse'
op|'.'
name|'IndentedHelpFormatter'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|format_description
dedent|''
name|'def'
name|'format_description'
op|'('
name|'self'
op|','
name|'description'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'description'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'description'
op|'+'
string|'"\\n"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'""'
newline|'\n'
nl|'\n'
DECL|function|printUsage
dedent|''
dedent|''
dedent|''
name|'def'
name|'printUsage'
op|'('
name|'commands'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'"usage: %s <command> [options]"'
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|'""'
newline|'\n'
name|'print'
string|'"valid commands: %s"'
op|'%'
string|'", "'
op|'.'
name|'join'
op|'('
name|'commands'
op|')'
newline|'\n'
name|'print'
string|'""'
newline|'\n'
name|'print'
string|'"Try %s <command> --help for command specific help."'
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|'""'
newline|'\n'
nl|'\n'
DECL|variable|commands
dedent|''
name|'commands'
op|'='
op|'{'
nl|'\n'
string|'"debug"'
op|':'
name|'P4Debug'
op|'('
op|')'
op|','
nl|'\n'
string|'"clean-tags"'
op|':'
name|'P4CleanTags'
op|'('
op|')'
op|','
nl|'\n'
string|'"submit"'
op|':'
name|'P4Sync'
op|'('
op|')'
op|','
nl|'\n'
string|'"sync"'
op|':'
name|'GitSync'
op|'('
op|')'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
op|']'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'    '
name|'printUsage'
op|'('
name|'commands'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|cmd
dedent|''
name|'cmd'
op|'='
string|'""'
newline|'\n'
DECL|variable|cmdName
name|'cmdName'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'cmd'
op|'='
name|'commands'
op|'['
name|'cmdName'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'"unknown command %s"'
op|'%'
name|'cmdName'
newline|'\n'
name|'print'
string|'""'
newline|'\n'
name|'printUsage'
op|'('
name|'commands'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|options
dedent|''
name|'options'
op|'='
name|'cmd'
op|'.'
name|'options'
newline|'\n'
name|'cmd'
op|'.'
name|'gitdir'
op|'='
name|'gitdir'
newline|'\n'
name|'options'
op|'.'
name|'append'
op|'('
name|'optparse'
op|'.'
name|'make_option'
op|'('
string|'"--git-dir"'
op|','
name|'dest'
op|'='
string|'"gitdir"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|parser
name|'parser'
op|'='
name|'optparse'
op|'.'
name|'OptionParser'
op|'('
name|'cmd'
op|'.'
name|'usage'
op|'.'
name|'replace'
op|'('
string|'"%prog"'
op|','
string|'"%prog "'
op|'+'
name|'cmdName'
op|')'
op|','
nl|'\n'
name|'options'
op|','
nl|'\n'
DECL|variable|description
name|'description'
op|'='
name|'cmd'
op|'.'
name|'description'
op|','
nl|'\n'
DECL|variable|formatter
name|'formatter'
op|'='
name|'HelpFormatter'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
op|'('
name|'cmd'
op|','
name|'args'
op|')'
op|'='
name|'parser'
op|'.'
name|'parse_args'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'2'
op|':'
op|']'
op|','
name|'cmd'
op|')'
op|';'
newline|'\n'
nl|'\n'
DECL|variable|gitdir
name|'gitdir'
op|'='
name|'cmd'
op|'.'
name|'gitdir'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'gitdir'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
DECL|variable|gitdir
indent|'    '
name|'gitdir'
op|'='
string|'".git"'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'isValidGitDir'
op|'('
name|'gitdir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'isValidGitDir'
op|'('
name|'gitdir'
op|'+'
string|'"/.git"'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'gitdir'
op|'+='
string|'"/.git"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'die'
op|'('
string|'"fatal: cannot locate git repository at %s"'
op|'%'
name|'gitdir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'os'
op|'.'
name|'environ'
op|'['
string|'"GIT_DIR"'
op|']'
op|'='
name|'gitdir'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'cmd'
op|'.'
name|'run'
op|'('
name|'args'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'.'
name|'print_help'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
