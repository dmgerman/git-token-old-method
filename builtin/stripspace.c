begin_unit
begin_include
include|#
directive|include
file|"builtin.h"
end_include
begin_include
include|#
directive|include
file|"cache.h"
end_include
begin_include
include|#
directive|include
file|"strbuf.h"
end_include
begin_function
DECL|function|comment_lines
specifier|static
name|void
name|comment_lines
parameter_list|(
name|struct
name|strbuf
modifier|*
name|buf
parameter_list|)
block|{
name|char
modifier|*
name|msg
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|msg
operator|=
name|strbuf_detach
argument_list|(
name|buf
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
name|strbuf_add_commented_lines
argument_list|(
name|buf
argument_list|,
name|msg
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function
begin_decl_stmt
DECL|variable|usage_msg
specifier|static
specifier|const
name|char
modifier|*
name|usage_msg
init|=
literal|"\n"
literal|"  git stripspace [-s | --strip-comments]< input\n"
literal|"  git stripspace [-c | --comment-lines]< input"
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|cmd_stripspace
name|int
name|cmd_stripspace
parameter_list|(
name|int
name|argc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|)
block|{
name|struct
name|strbuf
name|buf
init|=
name|STRBUF_INIT
decl_stmt|;
name|int
name|strip_comments
init|=
literal|0
decl_stmt|;
enum|enum
block|{
name|INVAL
init|=
literal|0
block|,
name|STRIP_SPACE
init|=
literal|1
block|,
name|COMMENT_LINES
init|=
literal|2
block|}
name|mode
init|=
name|STRIP_SPACE
enum|;
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"-s"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--strip-comments"
argument_list|)
condition|)
block|{
name|strip_comments
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"-c"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--comment-lines"
argument_list|)
condition|)
block|{
name|mode
operator|=
name|COMMENT_LINES
expr_stmt|;
block|}
else|else
block|{
name|mode
operator|=
name|INVAL
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|mode
operator|=
name|INVAL
expr_stmt|;
block|}
if|if
condition|(
name|mode
operator|==
name|INVAL
condition|)
name|usage
argument_list|(
name|usage_msg
argument_list|)
expr_stmt|;
if|if
condition|(
name|strip_comments
operator|||
name|mode
operator|==
name|COMMENT_LINES
condition|)
name|git_config
argument_list|(
name|git_default_config
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|strbuf_read
argument_list|(
operator|&
name|buf
argument_list|,
literal|0
argument_list|,
literal|1024
argument_list|)
operator|<
literal|0
condition|)
name|die_errno
argument_list|(
literal|"could not read the input"
argument_list|)
expr_stmt|;
if|if
condition|(
name|mode
operator|==
name|STRIP_SPACE
condition|)
name|strbuf_stripspace
argument_list|(
operator|&
name|buf
argument_list|,
name|strip_comments
argument_list|)
expr_stmt|;
else|else
name|comment_lines
argument_list|(
operator|&
name|buf
argument_list|)
expr_stmt|;
name|write_or_die
argument_list|(
literal|1
argument_list|,
name|buf
operator|.
name|buf
argument_list|,
name|buf
operator|.
name|len
argument_list|)
expr_stmt|;
name|strbuf_release
argument_list|(
operator|&
name|buf
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function
end_unit
