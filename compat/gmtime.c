begin_unit
begin_include
include|#
directive|include
file|"../git-compat-util.h"
end_include
begin_undef
DECL|macro|gmtime
undef|#
directive|undef
name|gmtime
end_undef
begin_undef
DECL|macro|gmtime_r
undef|#
directive|undef
name|gmtime_r
end_undef
begin_function
DECL|function|git_gmtime
name|struct
name|tm
modifier|*
name|git_gmtime
parameter_list|(
specifier|const
name|time_t
modifier|*
name|timep
parameter_list|)
block|{
specifier|static
name|struct
name|tm
name|result
decl_stmt|;
return|return
name|git_gmtime_r
argument_list|(
name|timep
argument_list|,
operator|&
name|result
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|git_gmtime_r
name|struct
name|tm
modifier|*
name|git_gmtime_r
parameter_list|(
specifier|const
name|time_t
modifier|*
name|timep
parameter_list|,
name|struct
name|tm
modifier|*
name|result
parameter_list|)
block|{
name|struct
name|tm
modifier|*
name|ret
decl_stmt|;
name|memset
argument_list|(
name|result
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|result
argument_list|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|gmtime_r
argument_list|(
name|timep
argument_list|,
name|result
argument_list|)
expr_stmt|;
comment|/* 	 * Rather than NULL, FreeBSD gmtime simply leaves the "struct tm" 	 * untouched when it encounters overflow. Since "mday" cannot otherwise 	 * be zero, we can test this very quickly. 	 */
if|if
condition|(
name|ret
operator|&&
operator|!
name|ret
operator|->
name|tm_mday
condition|)
block|{
name|ret
operator|=
name|NULL
expr_stmt|;
name|errno
operator|=
name|EOVERFLOW
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function
end_unit
