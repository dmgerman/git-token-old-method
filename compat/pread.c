begin_unit
begin_include
include|#
directive|include
file|"../git-compat-util.h"
end_include
begin_function
DECL|function|git_pread
name|ssize_t
name|git_pread
parameter_list|(
name|int
name|fd
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|size_t
name|count
parameter_list|,
name|off_t
name|offset
parameter_list|)
block|{
name|off_t
name|current_offset
decl_stmt|;
name|ssize_t
name|rc
decl_stmt|;
name|current_offset
operator|=
name|lseek
argument_list|(
name|fd
argument_list|,
literal|0
argument_list|,
name|SEEK_CUR
argument_list|)
expr_stmt|;
if|if
condition|(
name|lseek
argument_list|(
name|fd
argument_list|,
name|offset
argument_list|,
name|SEEK_SET
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|rc
operator|=
name|read_in_full
argument_list|(
name|fd
argument_list|,
name|buf
argument_list|,
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
name|current_offset
operator|!=
name|lseek
argument_list|(
name|fd
argument_list|,
name|current_offset
argument_list|,
name|SEEK_SET
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
name|rc
return|;
block|}
end_function
end_unit
