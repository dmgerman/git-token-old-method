begin_unit
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'subprocess'
newline|'\n'
nl|'\n'
name|'from'
name|'git_remote_helpers'
op|'.'
name|'util'
name|'import'
name|'die'
op|','
name|'warn'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|NonLocalGit
name|'class'
name|'NonLocalGit'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Handler to interact with non-local repos.\n    """'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'repo'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Creates a new non-local handler for the specified repo.\n        """'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'repo'
op|'='
name|'repo'
newline|'\n'
nl|'\n'
DECL|member|clone
dedent|''
name|'def'
name|'clone'
op|'('
name|'self'
op|','
name|'base'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Clones the non-local repo to base.\n\n        Does nothing if a clone already exists.\n        """'
newline|'\n'
nl|'\n'
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'repo'
op|'.'
name|'get_base_path'
op|'('
name|'base'
op|')'
op|','
string|"'.git'"
op|')'
newline|'\n'
nl|'\n'
comment|'# already cloned'
nl|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'path'
newline|'\n'
nl|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'path'
op|')'
newline|'\n'
name|'args'
op|'='
op|'['
string|'"git"'
op|','
string|'"clone"'
op|','
string|'"--bare"'
op|','
string|'"--quiet"'
op|','
name|'self'
op|'.'
name|'repo'
op|'.'
name|'gitpath'
op|','
name|'path'
op|']'
newline|'\n'
nl|'\n'
name|'child'
op|'='
name|'subprocess'
op|'.'
name|'Popen'
op|'('
name|'args'
op|')'
newline|'\n'
name|'if'
name|'child'
op|'.'
name|'wait'
op|'('
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'CalledProcessError'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'path'
newline|'\n'
nl|'\n'
DECL|member|update
dedent|''
name|'def'
name|'update'
op|'('
name|'self'
op|','
name|'base'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Updates checkout of the non-local repo in base.\n        """'
newline|'\n'
nl|'\n'
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'repo'
op|'.'
name|'get_base_path'
op|'('
name|'base'
op|')'
op|','
string|"'.git'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'die'
op|'('
string|'"could not find repo at %s"'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'args'
op|'='
op|'['
string|'"git"'
op|','
string|'"--git-dir="'
op|'+'
name|'path'
op|','
string|'"fetch"'
op|','
string|'"--quiet"'
op|','
name|'self'
op|'.'
name|'repo'
op|'.'
name|'gitpath'
op|']'
newline|'\n'
name|'child'
op|'='
name|'subprocess'
op|'.'
name|'Popen'
op|'('
name|'args'
op|')'
newline|'\n'
name|'if'
name|'child'
op|'.'
name|'wait'
op|'('
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'CalledProcessError'
newline|'\n'
nl|'\n'
dedent|''
name|'args'
op|'='
op|'['
string|'"git"'
op|','
string|'"--git-dir="'
op|'+'
name|'path'
op|','
string|'"update-ref"'
op|','
string|'"refs/heads/master"'
op|','
string|'"FETCH_HEAD"'
op|']'
newline|'\n'
name|'child'
op|'='
name|'subprocess'
op|'.'
name|'Popen'
op|'('
name|'args'
op|')'
newline|'\n'
name|'if'
name|'child'
op|'.'
name|'wait'
op|'('
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'CalledProcessError'
newline|'\n'
nl|'\n'
DECL|member|push
dedent|''
dedent|''
name|'def'
name|'push'
op|'('
name|'self'
op|','
name|'base'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Pushes from the non-local repo to base.\n        """'
newline|'\n'
nl|'\n'
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'repo'
op|'.'
name|'get_base_path'
op|'('
name|'base'
op|')'
op|','
string|"'.git'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'die'
op|'('
string|'"could not find repo at %s"'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'args'
op|'='
op|'['
string|'"git"'
op|','
string|'"--git-dir="'
op|'+'
name|'path'
op|','
string|'"push"'
op|','
string|'"--quiet"'
op|','
name|'self'
op|'.'
name|'repo'
op|'.'
name|'gitpath'
op|']'
newline|'\n'
name|'child'
op|'='
name|'subprocess'
op|'.'
name|'Popen'
op|'('
name|'args'
op|')'
newline|'\n'
name|'if'
name|'child'
op|'.'
name|'wait'
op|'('
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'CalledProcessError'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
